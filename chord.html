<html>
	<head>
		<style>
			.center {
				margin: 0 auto;
			}
			body {
				margin: 3em;
			}
			h2 {
				text-align:center;
			}
			table.equal {
				table-layout: fixed;
				width: 100%;
			}
			table.equal td {
				border: 1px solid black;
				width: 2%;
				text-align: left;
				vertical-align: top;
			}
			table.equal input {
				vertical-align: middle;
			}
			table.equal img {
				vertical-align: middle;
			}
			table.fretboard {
				border-collapse: collapse;
				background-image: linear-gradient(to bottom, #CBA 0%, #A98 100%);
			}
			table.fretboard td {
				border: none;
				text-align: right;
				background-origin: border-box;
			}
			table.fretboard th {
				background-image: linear-gradient(to bottom, white, white);
			}
			table.fretboard td.s0 { background-image: linear-gradient(to bottom, transparent, transparent 47%, #FFF 47%, #EEE 50%, #777 53%, transparent 53%), linear-gradient(to left, #FFF 0px, #CCC 2px, #CCC 4px, #777 6px, transparent 6px) }
			table.fretboard td.s1 { background-image: linear-gradient(to bottom, transparent, transparent 46%, #FFF 46%, #EEE 50%, #777 54%, transparent 54%), linear-gradient(to left, #FFF 0px, #CCC 2px, #CCC 4px, #777 6px, transparent 6px) }
			table.fretboard td.s2 { background-image: linear-gradient(to bottom, transparent, transparent 45%, #FFF 45%, #EEE 50%, #777 55%, transparent 55%), linear-gradient(to left, #FFF 0px, #CCC 2px, #CCC 4px, #777 6px, transparent 6px) }
			table.fretboard td.s3 { background-image: linear-gradient(to bottom, transparent, transparent 44%, #FFF 44%, #EEE 50%, #777 56%, transparent 56%), linear-gradient(to left, #FFF 0px, #CCC 2px, #CCC 4px, #777 6px, transparent 6px) }
			table.fretboard td.s4 { background-image: linear-gradient(to bottom, transparent, transparent 43%, #FFF 43%, #EEE 50%, #777 57%, transparent 57%), linear-gradient(to left, #FFF 0px, #CCC 2px, #CCC 4px, #777 6px, transparent 6px) }
			table.fretboard td.s5 { background-image: linear-gradient(to bottom, transparent, transparent 42%, #FFF 42%, #EEE 50%, #777 58%, transparent 58%), linear-gradient(to left, #FFF 0px, #CCC 2px, #CCC 4px, #777 6px, transparent 6px) }
			table.fretboard td.f00 { width: 0.5%; background-color: #DDD; background-image: none; }
			table.fretboard td.f01 { width: 4.7193% }
			table.fretboard td.f02 { width: 4.4544% }
			table.fretboard td.f03 { width: 4.2044% }
			table.fretboard td.f04 { width: 3.9685% }
			table.fretboard td.f05 { width: 3.7457% }
			table.fretboard td.f06 { width: 3.5355% }
			table.fretboard td.f07 { width: 3.3370% }
			table.fretboard td.f08 { width: 3.1498% }
			table.fretboard td.f09 { width: 2.9730% }
			table.fretboard td.f10 { width: 2.8061% }
			table.fretboard td.f11 { width: 2.6486% }
			table.fretboard td.f12 { width: 2.5000% }
			table.fretboard td.f13 { width: 2.3596% }
			table.fretboard td.f14 { width: 2.2272% }
			table.fretboard td.f15 { width: 2.1022% }
			table.fretboard div {
				float: right;
				min-width:  20pt;
				min-height: 20pt;
				text-align: center;
				vertical-align: center;
			}
			table.fretboard div.t1   { background-image: url("img/t1.svg");   }
			table.fretboard div.t2f  { background-image: url("img/t2f.svg");  }
			table.fretboard div.t2   { background-image: url("img/t2.svg");   }
			table.fretboard div.t3f  { background-image: url("img/t3f.svg");  }
			table.fretboard div.t3   { background-image: url("img/t3.svg");   }
			table.fretboard div.t4   { background-image: url("img/t4.svg");   }
			table.fretboard div.t5f  { background-image: url("img/t5f.svg");  }
			table.fretboard div.t5   { background-image: url("img/t5.svg");   }
			table.fretboard div.t5s  { background-image: url("img/t5s.svg");  }
			table.fretboard div.t6f  { background-image: url("img/t6f.svg");  }
			table.fretboard div.t6   { background-image: url("img/t6.svg");   }
			table.fretboard div.t7ff { background-image: url("img/t7ff.svg"); }
			table.fretboard div.t7f  { background-image: url("img/t7f.svg");  }
			table.fretboard div.t7   { background-image: url("img/t7.svg");   }
			table.fretboard div.t9f  { background-image: url("img/t9f.svg");  }
			table.fretboard div.t9   { background-image: url("img/t9.svg");   }
			table.fretboard div.t9s  { background-image: url("img/t9s.svg");  }
			table.fretboard div.t11f { background-image: url("img/t11f.svg"); }
			table.fretboard div.t11  { background-image: url("img/t11.svg");  }
			table.fretboard div.t11s { background-image: url("img/t11s.svg"); }
			table.fretboard div.t13f { background-image: url("img/t13f.svg"); }
			table.fretboard div.t13  { background-image: url("img/t13.svg");  }

			table.fretboard div.marked { content: url("img/mark.svg"); }

			#diagram {
				font-family: monospace;
				font-size: 150%;
				text-align: center;
				color: gray;
			}
		</style>
	</head>
	<body onload="init()">
		<h2>Root Note</h2>
		<table class="equal center">
			<tr>
				<td><input type="radio" onchange="onChangeRoot('c')"  name="root" checked>C</td>
				<td><input type="radio" onchange="onChangeRoot('g')"  name="root">G</td>
				<td><input type="radio" onchange="onChangeRoot('d')"  name="root">D</td>
				<td><input type="radio" onchange="onChangeRoot('a')"  name="root">A</td>
				<td><input type="radio" onchange="onChangeRoot('e')"  name="root">E</td>
				<td><input type="radio" onchange="onChangeRoot('b')"  name="root">B</td>
				<td><input type="radio" onchange="onChangeRoot('fs')" name="root">F&sharp;</td>
				<td><input type="radio" onchange="onChangeRoot('cs')" name="root">C&sharp;</td>
				<td><input type="radio" onchange="onChangeRoot('f')"  name="root">F</td>
				<td><input type="radio" onchange="onChangeRoot('bf')" name="root">B&flat;</td>
				<td><input type="radio" onchange="onChangeRoot('ef')" name="root">E&flat;</td>
				<td><input type="radio" onchange="onChangeRoot('af')" name="root">A&flat;</td>
				<td><input type="radio" onchange="onChangeRoot('df')" name="root">D&flat;</td>
				<td><input type="radio" onchange="onChangeRoot('gf')" name="root">G&flat;</td>
				<td><input type="radio" onchange="onChangeRoot('cf')" name="root">C&flat;</td>
			</tr>
		</table>

		<h2>Chord Tones</h2>
		<table class="equal center">
			<tr>
				<th id="degree1">C</th>
				<th></th>
				<th id="degree2">D</th>
				<th> </th>
				<th id="degree3">E</th>
				<th id="degree4">F</th>
				<th></th>
				<th id="degree5">G</th>
				<th></th>
				<th id="degree6">A</th>
				<th></th>
				<th id="degree7">B</th>
			</tr>
			<tr>
				<td>
					<div>           <input type="radio" onchange="onChangeTone(event)" name="tone0" value="0">         <img src="img/none.svg"></div>
					<div id="t1">   <input type="radio" onchange="onChangeTone(event)" name="tone0" value="0" checked> <img src="img/t1.svg"></div>
				</td>
				<td>
					<div>           <input type="radio" onchange="onChangeTone(event)" name="tone1" value="1" checked> <img src="img/none.svg"></div>
					<div id="t2f">  <input type="radio" onchange="onChangeTone(event)" name="tone1" value="1">         <img src="img/t2f.svg"></div>
					<div id="t9f">  <input type="radio" onchange="onChangeTone(event)" name="tone1" value="1">         <img src="img/t9f.svg"></div>
				</td>
				<td>
					<div>           <input type="radio" onchange="onChangeTone(event)" name="tone2" value="2" checked> <img src="img/none.svg"></div>
					<div id="t2">   <input type="radio" onchange="onChangeTone(event)" name="tone2" value="2">         <img src="img/t2.svg"></div>
					<div id="t9">   <input type="radio" onchange="onChangeTone(event)" name="tone2" value="2">         <img src="img/t9.svg"></div>
				</td>
				<td>
					<div>           <input type="radio" onchange="onChangeTone(event)" name="tone3" value="3" checked> <img src="img/none.svg"></div>
					<div id="t3f">  <input type="radio" onchange="onChangeTone(event)" name="tone3" value="3">         <img src="img/t3f.svg"></div>
					<div id="t9s">  <input type="radio" onchange="onChangeTone(event)" name="tone3" value="3">         <img src="img/t9s.svg"></div>
				</td>
				<td>
					<div>           <input type="radio" onchange="onChangeTone(event)" name="tone4" value="4">         <img src="img/none.svg"></div>
					<div id="t3">   <input type="radio" onchange="onChangeTone(event)" name="tone4" value="4" checked> <img src="img/t3.svg"></div>
					<div id="t11f"> <input type="radio" onchange="onChangeTone(event)" name="tone4" value="4">         <img src="img/t11f.svg"></div>
				</td>
				<td>
					<div>           <input type="radio" onchange="onChangeTone(event)" name="tone5" value="5" checked> <img src="img/none.svg"></div>
					<div id="t4">   <input type="radio" onchange="onChangeTone(event)" name="tone5" value="5">         <img src="img/t4.svg"></div>
					<div id="t11">  <input type="radio" onchange="onChangeTone(event)" name="tone5" value="5">         <img src="img/t11.svg"></div>
				</td>
				<td>
					<div>           <input type="radio" onchange="onChangeTone(event)" name="tone6" value="6" checked> <img src="img/none.svg"></div>
					<div id="t5f">  <input type="radio" onchange="onChangeTone(event)" name="tone6" value="6">         <img src="img/t5f.svg"></div>
					<div id="t11s"> <input type="radio" onchange="onChangeTone(event)" name="tone6" value="6">         <img src="img/t11s.svg"></div>
				</td>
				<td>
					<div>           <input type="radio" onchange="onChangeTone(event)" name="tone7" value="7">         <img src="img/none.svg"></div>
					<div id="t5">   <input type="radio" onchange="onChangeTone(event)" name="tone7" value="7" checked> <img src="img/t5.svg"></div>
				</td>
				<td>
					<div>           <input type="radio" onchange="onChangeTone(event)" name="tone8" value="8" checked> <img src="img/none.svg"></div>
					<div id="t5s">  <input type="radio" onchange="onChangeTone(event)" name="tone8" value="8">         <img src="img/t5s.svg"></div>
					<div id="t6f">  <input type="radio" onchange="onChangeTone(event)" name="tone8" value="8">         <img src="img/t6f.svg"></div>
					<div id="t13f"> <input type="radio" onchange="onChangeTone(event)" name="tone8" value="8">         <img src="img/t13f.svg"></div>
				</td>
				<td>
					<div>           <input type="radio" onchange="onChangeTone(event)" name="tone9" value="9" checked> <img src="img/none.svg"></div>
					<div id="t6">   <input type="radio" onchange="onChangeTone(event)" name="tone9" value="9">         <img src="img/t6.svg"></div>
					<div id="t7ff"> <input type="radio" onchange="onChangeTone(event)" name="tone9" value="9">         <img src="img/t7ff.svg"></div>
					<div id="t13">  <input type="radio" onchange="onChangeTone(event)" name="tone9" value="9">         <img src="img/t13.svg"></div>
				</td>
				<td>
					<div>           <input type="radio" onchange="onChangeTone(event)" name="tone10" value="10" checked> <img src="img/none.svg"></div>
					<div id="t7f">  <input type="radio" onchange="onChangeTone(event)" name="tone10" value="10">         <img src="img/t7f.svg"></div>
				</td>
				<td>
					<div>           <input type="radio" onchange="onChangeTone(event)" name="tone11" value="11" checked> <img src="img/none.svg"></div>
					<div id="t7">   <input type="radio" onchange="onChangeTone(event)" name="tone11" value="11">         <img src="img/t7.svg"></div>
				</td>
		</table>

		<h2>Fretboard</h2>
		<table class="fretboard">
			<tr>
				<th>0</th>
				<th>1</th>
				<th>2</th>
				<th>3</th>
				<th>4</th>
				<th>5</th>
				<th>6</th>
				<th>7</th>
				<th>8</th>
				<th>9</th>
				<th>10</th>
				<th>11</th>
				<th>12</th>
				<th>13</th>
				<th>14</th>
				<th>15</th>
			</tr>
			<tr>
				<td class="s0 f00"><div onclick="onClickNote(event, 0, 00)" id="s0f00"></div></td>
				<td class="s0 f01"><div onclick="onClickNote(event, 0, 01)" id="s0f01"></div></td>
				<td class="s0 f02"><div onclick="onClickNote(event, 0, 02)" id="s0f02"></div></td>
				<td class="s0 f03"><div onclick="onClickNote(event, 0, 03)" id="s0f03"></div></td>
				<td class="s0 f04"><div onclick="onClickNote(event, 0, 04)" id="s0f04"></div></td>
				<td class="s0 f05"><div onclick="onClickNote(event, 0, 05)" id="s0f05"></div></td>
				<td class="s0 f06"><div onclick="onClickNote(event, 0, 06)" id="s0f06"></div></td>
				<td class="s0 f07"><div onclick="onClickNote(event, 0, 07)" id="s0f07"></div></td>
				<td class="s0 f08"><div onclick="onClickNote(event, 0, 08)" id="s0f08"></div></td>
				<td class="s0 f09"><div onclick="onClickNote(event, 0, 09)" id="s0f09"></div></td>
				<td class="s0 f10"><div onclick="onClickNote(event, 0, 10)" id="s0f10"></div></td>
				<td class="s0 f11"><div onclick="onClickNote(event, 0, 11)" id="s0f11"></div></td>
				<td class="s0 f12"><div onclick="onClickNote(event, 0, 12)" id="s0f12"></div></td>
				<td class="s0 f13"><div onclick="onClickNote(event, 0, 13)" id="s0f13"></div></td>
				<td class="s0 f14"><div onclick="onClickNote(event, 0, 14)" id="s0f14"></div></td>
				<td class="s0 f15"><div onclick="onClickNote(event, 0, 15)" id="s0f15"></div></td>
			</tr>
			<tr>
				<td class="s1 f00"><div onclick="onClickNote(event, 1, 00)" id="s1f00"></div></td>
				<td class="s1 f01"><div onclick="onClickNote(event, 1, 01)" id="s1f01"></div></td>
				<td class="s1 f02"><div onclick="onClickNote(event, 1, 02)" id="s1f02"></div></td>
				<td class="s1 f03"><div onclick="onClickNote(event, 1, 03)" id="s1f03"></div></td>
				<td class="s1 f04"><div onclick="onClickNote(event, 1, 04)" id="s1f04"></div></td>
				<td class="s1 f05"><div onclick="onClickNote(event, 1, 05)" id="s1f05"></div></td>
				<td class="s1 f06"><div onclick="onClickNote(event, 1, 06)" id="s1f06"></div></td>
				<td class="s1 f07"><div onclick="onClickNote(event, 1, 07)" id="s1f07"></div></td>
				<td class="s1 f08"><div onclick="onClickNote(event, 1, 08)" id="s1f08"></div></td>
				<td class="s1 f09"><div onclick="onClickNote(event, 1, 09)" id="s1f09"></div></td>
				<td class="s1 f10"><div onclick="onClickNote(event, 1, 10)" id="s1f10"></div></td>
				<td class="s1 f11"><div onclick="onClickNote(event, 1, 11)" id="s1f11"></div></td>
				<td class="s1 f12"><div onclick="onClickNote(event, 1, 12)" id="s1f12"></div></td>
				<td class="s1 f13"><div onclick="onClickNote(event, 1, 13)" id="s1f13"></div></td>
				<td class="s1 f14"><div onclick="onClickNote(event, 1, 14)" id="s1f14"></div></td>
				<td class="s1 f15"><div onclick="onClickNote(event, 1, 15)" id="s1f15"></div></td>
			</tr>
			<tr>
				<td class="s2 f00"><div onclick="onClickNote(event, 2, 00)" id="s2f00"></div></td>
				<td class="s2 f01"><div onclick="onClickNote(event, 2, 01)" id="s2f01"></div></td>
				<td class="s2 f02"><div onclick="onClickNote(event, 2, 02)" id="s2f02"></div></td>
				<td class="s2 f03"><div onclick="onClickNote(event, 2, 03)" id="s2f03"></div></td>
				<td class="s2 f04"><div onclick="onClickNote(event, 2, 04)" id="s2f04"></div></td>
				<td class="s2 f05"><div onclick="onClickNote(event, 2, 05)" id="s2f05"></div></td>
				<td class="s2 f06"><div onclick="onClickNote(event, 2, 06)" id="s2f06"></div></td>
				<td class="s2 f07"><div onclick="onClickNote(event, 2, 07)" id="s2f07"></div></td>
				<td class="s2 f08"><div onclick="onClickNote(event, 2, 08)" id="s2f08"></div></td>
				<td class="s2 f09"><div onclick="onClickNote(event, 2, 09)" id="s2f09"></div></td>
				<td class="s2 f10"><div onclick="onClickNote(event, 2, 10)" id="s2f10"></div></td>
				<td class="s2 f11"><div onclick="onClickNote(event, 2, 11)" id="s2f11"></div></td>
				<td class="s2 f12"><div onclick="onClickNote(event, 2, 12)" id="s2f12"></div></td>
				<td class="s2 f13"><div onclick="onClickNote(event, 2, 13)" id="s2f13"></div></td>
				<td class="s2 f14"><div onclick="onClickNote(event, 2, 14)" id="s2f14"></div></td>
				<td class="s2 f15"><div onclick="onClickNote(event, 2, 15)" id="s2f15"></div></td>
			</tr>
			<tr>
				<td class="s3 f00"><div onclick="onClickNote(event, 3, 00)" id="s3f00"></div></td>
				<td class="s3 f01"><div onclick="onClickNote(event, 3, 01)" id="s3f01"></div></td>
				<td class="s3 f02"><div onclick="onClickNote(event, 3, 02)" id="s3f02"></div></td>
				<td class="s3 f03"><div onclick="onClickNote(event, 3, 03)" id="s3f03"></div></td>
				<td class="s3 f04"><div onclick="onClickNote(event, 3, 04)" id="s3f04"></div></td>
				<td class="s3 f05"><div onclick="onClickNote(event, 3, 05)" id="s3f05"></div></td>
				<td class="s3 f06"><div onclick="onClickNote(event, 3, 06)" id="s3f06"></div></td>
				<td class="s3 f07"><div onclick="onClickNote(event, 3, 07)" id="s3f07"></div></td>
				<td class="s3 f08"><div onclick="onClickNote(event, 3, 08)" id="s3f08"></div></td>
				<td class="s3 f09"><div onclick="onClickNote(event, 3, 09)" id="s3f09"></div></td>
				<td class="s3 f10"><div onclick="onClickNote(event, 3, 10)" id="s3f10"></div></td>
				<td class="s3 f11"><div onclick="onClickNote(event, 3, 11)" id="s3f11"></div></td>
				<td class="s3 f12"><div onclick="onClickNote(event, 3, 12)" id="s3f12"></div></td>
				<td class="s3 f13"><div onclick="onClickNote(event, 3, 13)" id="s3f13"></div></td>
				<td class="s3 f14"><div onclick="onClickNote(event, 3, 14)" id="s3f14"></div></td>
				<td class="s3 f15"><div onclick="onClickNote(event, 3, 15)" id="s3f15"></div></td>
			</tr>
			<tr>
				<td class="s4 f00"><div onclick="onClickNote(event, 4, 00)" id="s4f00"></div></td>
				<td class="s4 f01"><div onclick="onClickNote(event, 4, 01)" id="s4f01"></div></td>
				<td class="s4 f02"><div onclick="onClickNote(event, 4, 02)" id="s4f02"></div></td>
				<td class="s4 f03"><div onclick="onClickNote(event, 4, 03)" id="s4f03"></div></td>
				<td class="s4 f04"><div onclick="onClickNote(event, 4, 04)" id="s4f04"></div></td>
				<td class="s4 f05"><div onclick="onClickNote(event, 4, 05)" id="s4f05"></div></td>
				<td class="s4 f06"><div onclick="onClickNote(event, 4, 06)" id="s4f06"></div></td>
				<td class="s4 f07"><div onclick="onClickNote(event, 4, 07)" id="s4f07"></div></td>
				<td class="s4 f08"><div onclick="onClickNote(event, 4, 08)" id="s4f08"></div></td>
				<td class="s4 f09"><div onclick="onClickNote(event, 4, 09)" id="s4f09"></div></td>
				<td class="s4 f10"><div onclick="onClickNote(event, 4, 10)" id="s4f10"></div></td>
				<td class="s4 f11"><div onclick="onClickNote(event, 4, 11)" id="s4f11"></div></td>
				<td class="s4 f12"><div onclick="onClickNote(event, 4, 12)" id="s4f12"></div></td>
				<td class="s4 f13"><div onclick="onClickNote(event, 4, 13)" id="s4f13"></div></td>
				<td class="s4 f14"><div onclick="onClickNote(event, 4, 14)" id="s4f14"></div></td>
				<td class="s4 f15"><div onclick="onClickNote(event, 4, 15)" id="s4f15"></div></td>
			</tr>
			<tr>
				<td class="s5 f00"><div onclick="onClickNote(event, 5, 00)" id="s5f00"></div></td>
				<td class="s5 f01"><div onclick="onClickNote(event, 5, 01)" id="s5f01"></div></td>
				<td class="s5 f02"><div onclick="onClickNote(event, 5, 02)" id="s5f02"></div></td>
				<td class="s5 f03"><div onclick="onClickNote(event, 5, 03)" id="s5f03"></div></td>
				<td class="s5 f04"><div onclick="onClickNote(event, 5, 04)" id="s5f04"></div></td>
				<td class="s5 f05"><div onclick="onClickNote(event, 5, 05)" id="s5f05"></div></td>
				<td class="s5 f06"><div onclick="onClickNote(event, 5, 06)" id="s5f06"></div></td>
				<td class="s5 f07"><div onclick="onClickNote(event, 5, 07)" id="s5f07"></div></td>
				<td class="s5 f08"><div onclick="onClickNote(event, 5, 08)" id="s5f08"></div></td>
				<td class="s5 f09"><div onclick="onClickNote(event, 5, 09)" id="s5f09"></div></td>
				<td class="s5 f10"><div onclick="onClickNote(event, 5, 10)" id="s5f10"></div></td>
				<td class="s5 f11"><div onclick="onClickNote(event, 5, 11)" id="s5f11"></div></td>
				<td class="s5 f12"><div onclick="onClickNote(event, 5, 12)" id="s5f12"></div></td>
				<td class="s5 f13"><div onclick="onClickNote(event, 5, 13)" id="s5f13"></div></td>
				<td class="s5 f14"><div onclick="onClickNote(event, 5, 14)" id="s5f14"></div></td>
				<td class="s5 f15"><div onclick="onClickNote(event, 5, 15)" id="s5f15"></div></td>
			</tr>
		</table>
		<p id="diagram"></p>
		<script>

			var maxString = 6;
			var maxFret  = 16;

			var pitch = {
				'cf' : 11, 'c' :  0, 'cs' :  1,
				'df' :  1, 'd' :  2, 'ds' :  3,
				'ef' :  3, 'e' :  4, 'es' :  5,
				'ff' :  4, 'f' :  5, 'fs' :  6,
				'gf' :  6, 'g' :  7, 'gs' :  8,
				'af' :  8, 'a' :  9, 'as' : 10,
				'bf' : 10, 'b' : 11, 'bs' : 12,
			};

			var html = {
				'cf' : "C&flat;",
				'c'  : "C",
				'cs' : "C&sharp;",
				'df' : "D&flat;",
				'd'  : "D",
				'ds' : "D&sharp;",
				'ef' : "E&flat;",
				'e'  : "E",
				'es' : "E&sharp;",
				'ff' : "F&flat;",
				'f'  : "F",
				'fs' : "F&sharp;",
				'gf' : "G&flat;",
				'g'  : "G",
				'gs' : "G&sharp;",
				'af' : "A&flat;",
				'a'  : "A",
				'as' : "A&sharp;",
				'bf' : "B&flat;",
				'b'  : "B",
				'bs' : "B&sharp;",
			};

			var key = {
				'c'  : [ 'c',  'd',  'e',  'f',  'g',  'a',  'b'  ],

				'g'  : [ 'g',  'a',  'b',  'c',  'd',  'e',  'fs' ],
				'd'  : [ 'd',  'e',  'fs', 'g',  'a',  'b',  'cs' ],
				'a'  : [ 'a',  'b',  'cs', 'd',  'e',  'fs', 'gs' ],
				'e'  : [ 'e',  'fs', 'gs', 'a',  'b',  'cs', 'ds' ],
				'b'  : [ 'b',  'cs', 'ds', 'e',  'fs', 'gs', 'as' ],
				'fs' : [ 'fs', 'gs', 'as', 'b',  'cs', 'ds', 'es' ],
				'cs' : [ 'cs', 'ds', 'es', 'fs', 'gs', 'as', 'bs' ],

				'f'  : [ 'f',  'g',  'a',  'bf', 'c',  'd',  'e'  ],
				'bf' : [ 'bf', 'c',  'd',  'ef', 'f',  'g',  'a'  ],
				'ef' : [ 'ef', 'f',  'g',  'af', 'bf', 'c',  'd'  ],
				'af' : [ 'af', 'bf', 'c',  'df', 'ef', 'f',  'g'  ],
				'df' : [ 'df', 'ef', 'f',  'gf', 'af', 'bf', 'c'  ],
				'gf' : [ 'gf', 'af', 'bf', 'cf', 'df', 'ef', 'f'  ],
				'cf' : [ 'cf', 'df', 'ef', 'ff', 'gf', 'af', 'bf' ],

			}

			var tone = {
				't1'  : { degree: 0, offset:  0 },
				't2f' : { degree: 1, offset: -1 },
				't2'  : { degree: 1, offset:  0 },
				't3f' : { degree: 2, offset: -1 },
				't3'  : { degree: 2, offset:  0 },
				't4'  : { degree: 3, offset:  0 },
				't5f' : { degree: 4, offset: -1 },
				't5'  : { degree: 4, offset:  0 },
				't5s' : { degree: 4, offset: +1 },
				't6f' : { degree: 5, offset: -1 },
				't6'  : { degree: 5, offset:  0 },
				't7ff': { degree: 6, offset: -2 },
				't7f' : { degree: 6, offset: -1 },
				't7'  : { degree: 6, offset:  0 },
				't9f' : { degree: 1, offset: -1 },
				't9'  : { degree: 1, offset:  0 },
				't9s' : { degree: 1, offset: +1 },
				't11f': { degree: 3, offset: -1 },
				't11' : { degree: 3, offset:  0 },
				't11s': { degree: 3, offset: +1 },
				't13f': { degree: 5, offset: -1 },
				't13' : { degree: 5, offset:  0 },
			}

			var pitchElement = [[], [], [], [],
					     		[], [], [], [],
					     		[], [], [], []];
			var degreeElement = [[], [], [], [], [], [], []];
			var positionElement = [[], [], [], [], [], []];

			/* Current root note and chord tone states */

			var currentRoot = 'c';
			var currentTone = [ "t1", undefined, undefined, undefined,
								"t3", undefined, undefined, "t5",
						   undefined, undefined, undefined, undefined,
						   undefined, undefined, undefined, undefined,
						   undefined, undefined, undefined, undefined,
						   undefined, undefined ];
			var currentMark = [ undefined, undefined, undefined,
								undefined, undefined, undefined ];

			/* Return the pitch (0-11) at string s (0-5) fret f. */

			function pitchAtPosition(s, f) {
				if (s == 0) { s = s + 1; f = f + 5; }
				if (s == 1) { s = s + 1; f = f + 4; }
				if (s == 2) { s = s + 1; f = f + 5; }
				if (s == 3) { s = s + 1; f = f + 5; }
				if (s == 4) { s = s + 1; f = f + 5; }

				return (f + 4) % 12;
			}

			/* Return the octave at string s (0-5) fret f. */

			function octaveAtPosition(s, f) {
				if (s == 0) { s = s + 1; f = f + 5; }
				if (s == 1) { s = s + 1; f = f + 4; }
				if (s == 2) { s = s + 1; f = f + 5; }
				if (s == 3) { s = s + 1; f = f + 5; }
				if (s == 4) { s = s + 1; f = f + 5; }

				return 4 + Math.floor((f - 8) / 12);
			}

			/* Return the identifier of the element at string s (0-5) fret f. */

			function idAtPosition(s, f) {
				if (f < 10) return 's' + s.toString() + 'f0' + f.toString();
				else        return 's' + s.toString() + 'f'  + f.toString();
			}

			/* Gather all elements for each note. */

			function init() {

				for (var s = 0; s < maxString; s++)
					for (var f = 0; f < maxFret; f++) {
						var i = pitchAtPosition(s, f);
						var n =    idAtPosition(s, f);

						positionElement[s][f] = document.getElementById(n);

						pitchElement[i].push(positionElement[s][f]);
					}

				degreeElement[0] = document.getElementById('degree1');
				degreeElement[1] = document.getElementById('degree2');
				degreeElement[2] = document.getElementById('degree3');
				degreeElement[3] = document.getElementById('degree4');
				degreeElement[4] = document.getElementById('degree5');
				degreeElement[5] = document.getElementById('degree6');
				degreeElement[6] = document.getElementById('degree7');

				update();
			}

			/* Null the className on all position elements. */

			function clearClassNames() {
				for (var s = 0; s < maxString; s++)
					for (var f = 0; f < maxFret; f++)
						positionElement[s][f].className = "";
			}

			/* Set the class on the marked positions. Remove invalid marks. */

			function setMarks() {
				for (var s = 0; s < maxString; s++) {
					if (typeof currentMark[s] === 'number') {
						if (positionElement[s][currentMark[s]].className)
							positionElement[s][currentMark[s]].className += ' marked';
						else
							currentMark[s] = 'undefined';
					}
				}
			}

			/* Set the classes on all position elements to show the selection. */

			function setPositions() {

				for (var i = 0; i < 12; i++)
				{
					if (currentTone[i])
					{
						var t = currentTone[i];
						var d = tone[t].degree;
						var a = tone[t].offset;

						var k = (pitch[key[currentRoot][d]] + a) % 12;

						for (var j = 0; j < pitchElement[k].length; j++)
							pitchElement[k][j].className = currentTone[i];
					}
				}
			}

			/* Compute the LilyPond diagram for the current selection. */

			function setDiagram() {
				function getOctave(o) {
					if (o === 3) return ",";
					if (o === 4) return "";
					if (o === 5) return "'";
					if (o === 6) return "''";
				}
				function getAccidental(a) {
					if (a === +1) return 's';
					if (a ===  0) return '';
					if (a === -1) return 'f';
					if (a === -2) return 'ff';
				}
				function simplify(s) {
					if (s.match('sf')) return simplify(s.replace('sf', ''));
					if (s.match('fs')) return simplify(s.replace('fs', ''));
					return s;
				}

				var chord   = [];
				var diagram = [];

				for (var s = maxString - 1; s >= 0; s--) {
					if (typeof currentMark[s] === 'number') {
						var t = positionElement[s][currentMark[s]].className.split(' ')[0];
						var d = tone[t].degree;
						var a = tone[t].offset;
						var o = octaveAtPosition(s, currentMark[s]);

						var n = key[currentRoot][d][0];
						var e = key[currentRoot][d].substring(1);

						chord.push(n + simplify(e + getAccidental(a)) + getOctave(o));

						if (currentMark[s] > 0)
							diagram.push(currentMark[s] + ';');
						else
							diagram.push('o' + ';');
					} else
						diagram.push('x;');
				}

				var str = '<' + chord.join(' ') + '>1^\\markup { \\fret-diagram-terse #"' + diagram.join('') + '" }'

				document.getElementById('diagram').textContent = str;
			}

			/* Update the DOM to reflect the current state. */

			function update() {
				clearClassNames();
				setPositions();
				setMarks();
				setDiagram();
			}

			/* Select a root note. */

			function onChangeRoot(s) {
				for (var d = 0; d < 7; d++)
					degreeElement[d].innerHTML = html[key[s][d]];
				currentRoot = s;
				update();
			}

			/* Select a chord tone. */

			function onChangeTone(e) {
				currentTone[e.target.value] = e.target.parentElement.id;
				update();
			}

			/* Toggle the mark on a position. */

			function onClickNote(e, s, f) {
				if (currentMark[s] == f)
					currentMark[s] = undefined;
				else
					currentMark[s] = f;
				update();
			}
		</script>
	</body>
</html>